# Auth with ConnectTokens

This example will showcase how to get a `ConnectToken` to establish a connection with a game server.

You can find more information in the [book](https://cbournhonesque.github.io/lightyear/book/concepts/connection/title.html#netcode), but basically
you need a `ConnectToken` to establish a connection with a server using the Netcode protocol. (it is not required if you are using 
a different means to establish a connection, such as steam sockets)

The `ConnectToken` is a token that is generated by a backend server, using a private key that is shared with your game servers.
It is sent to the client using a secure method of your choice (TCP+TLS, websockets, HTTPS, etc.).
Once the client has received the `ConnectToken`, they can use it to establish a connection with the game server.

In this example, the game server and the backend will run in the same process. The server will run a separate task
that listens on a TCP socket for incoming requests. For every request, it will generate a `ConnectToken` that it will send
to the client. The client can then use the `ConnectToken` to start the `lightyear` connection.


## Running the example

- Run the server with a gui: `cargo run server`
- Run client with id 1: `cargo run client -c 1`
- Run client with id 2: `cargo run client -c 2`
- Run the client and server in two separate bevy Apps: `cargo run` or `cargo run separate`
- Run the server without a gui: `cargo run --no-default-features --features=server`
- Run the client and server in "HostServer" mode, where the server is also a client (there is only one App): `cargo run host-server`

You can control the behaviour of the example by changing the list of features. By default, all features are enabled (client, server, gui).
For example you can run the server in headless mode (without gui) by running `cargo run --no-default-features --features=server`.
You can modify the file `assets/settings.ron` to modify some networking settings.

### Testing in wasm with webtransport

NOTE: I am using [trunk](https://trunkrs.dev/) to build and serve the wasm example.

You will need a valid SSL certificate to test the example in wasm using webtransport. You will need to run the following
commands:
- `cd "$(git rev-parse --show-toplevel)" && sh examples/certificates/generate.sh` (to generate the temporary SSL
  certificates, they are only valid for 2 weeks)
- Start the server with: `cargo run -- server`
- Then start the wasm client wasm with ``RUSTFLAGS='--cfg getrandom_backend="wasm_js"' trunk server --features=client``